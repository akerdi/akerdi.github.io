<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>2018-11-14lesson | aKer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Reactcreate-react-app 功能有：··· axios 网络获取数据rem 手机距离适配，同时添加less-loaderyarn add less less-loaderyarn add autoprefixer 在/public/index.html  中间插入 12&amp;lt;script&amp;gt;!function(e)&amp;#123;function t(a)&amp;#123;if(i[a">
<meta property="og:type" content="article">
<meta property="og:title" content="2018-11-14lesson">
<meta property="og:url" content="https://akerdi.github.io/2018/11/14/2018-11-14lesson/index.html">
<meta property="og:site_name" content="aKer">
<meta property="og:description" content="Reactcreate-react-app 功能有：··· axios 网络获取数据rem 手机距离适配，同时添加less-loaderyarn add less less-loaderyarn add autoprefixer 在/public/index.html  中间插入 12&amp;lt;script&amp;gt;!function(e)&amp;#123;function t(a)&amp;#123;if(i[a">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2023-03-07T09:24:38.369Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2018-11-14lesson">
<meta name="twitter:description" content="Reactcreate-react-app 功能有：··· axios 网络获取数据rem 手机距离适配，同时添加less-loaderyarn add less less-loaderyarn add autoprefixer 在/public/index.html  中间插入 12&amp;lt;script&amp;gt;!function(e)&amp;#123;function t(a)&amp;#123;if(i[a">
  
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">
  <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      document.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightBlock(block);
      });
    });
  </script>
  <link rel="stylesheet" href="/css/index.css">
</head>
</html>
<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Clover Tuan</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn iconfont icon-dribbble"></a>
          
        
          
            <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn iconfont icon-behance"></a>
          
        
          
            <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn iconfont icon-lofter"></a>
          
        
          
            <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn iconfont icon-instagram"></a>
          
        
          
            <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">2018-11-14lesson</h2>
  <p class="sub">Nov 14, 2018</p>
  <article class="content">
    <h1 id="React"><a href="#React" class="headerlink" title="React"></a>React</h1><p>create-react-app</p>
<p>功能有：<br>···</p>
<h2 id="axios-网络获取数据"><a href="#axios-网络获取数据" class="headerlink" title="axios 网络获取数据"></a>axios 网络获取数据</h2><h2 id="rem-手机距离适配，同时添加less-loader"><a href="#rem-手机距离适配，同时添加less-loader" class="headerlink" title="rem 手机距离适配，同时添加less-loader"></a>rem 手机距离适配，同时添加less-loader</h2><p>yarn add less less-loader<br>yarn add autoprefixer</p>
<p>在/public/index.html <head><meta name="generator" content="Hexo 3.8.0"></head> 中间插入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;!<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="function"><span class="keyword">function</span> <span class="title">t</span>(<span class="params">a</span>)</span>&#123;<span class="keyword">if</span>(i[a])<span class="keyword">return</span> i[a].exports;<span class="keyword">var</span> n=i[a]=&#123;<span class="attr">exports</span>:&#123;&#125;,<span class="attr">id</span>:a,<span class="attr">loaded</span>:!<span class="number">1</span>&#125;;<span class="keyword">return</span> e[a].call(n.exports,n,n.exports,t),n.loaded=!<span class="number">0</span>,n.exports&#125;<span class="keyword">var</span> i=&#123;&#125;;<span class="keyword">return</span> t.m=e,t.c=i,t.p=<span class="string">""</span>,t(<span class="number">0</span>)&#125;([<span class="function"><span class="keyword">function</span>(<span class="params">e,t</span>)</span>&#123;<span class="string">"use strict"</span>;<span class="built_in">Object</span>.defineProperty(t,<span class="string">"__esModule"</span>,&#123;<span class="attr">value</span>:!<span class="number">0</span>&#125;);<span class="keyword">var</span> i=<span class="built_in">window</span>;t[<span class="string">"default"</span>]=i.flex=<span class="function"><span class="keyword">function</span>(<span class="params">e,t</span>)</span>&#123;<span class="keyword">var</span> a=e||<span class="number">100</span>,n=t||<span class="number">1</span>,r=i.document,o=navigator.userAgent,d=o.match(<span class="regexp">/Android[\S\s]+AppleWebkit\/(\d&#123;3&#125;)/i</span>),l=o.match(<span class="regexp">/U3\/((\d+|\.)&#123;5,&#125;)/i</span>),c=l&amp;&amp;<span class="built_in">parseInt</span>(l[<span class="number">1</span>].split(<span class="string">"."</span>).join(<span class="string">""</span>),<span class="number">10</span>)&gt;=<span class="number">80</span>,p=navigator.appVersion.match(<span class="regexp">/(iphone|ipad|ipod)/gi</span>),s=i.devicePixelRatio||<span class="number">1</span>;p||d&amp;&amp;d[<span class="number">1</span>]&gt;<span class="number">534</span>||c||(s=<span class="number">1</span>);<span class="keyword">var</span> u=<span class="number">1</span>/s,m=r.querySelector(<span class="string">'meta[name="viewport"]'</span>);m||(m=r.createElement(<span class="string">"meta"</span>),m.setAttribute(<span class="string">"name"</span>,<span class="string">"viewport"</span>),r.head.appendChild(m)),m.setAttribute(<span class="string">"content"</span>,<span class="string">"width=device-width,user-scalable=no,initial-scale="</span>+u+<span class="string">",maximum-scale="</span>+u+<span class="string">",minimum-scale="</span>+u),r.documentElement.style.fontSize=a/<span class="number">2</span>*s*n+<span class="string">"px"</span>&#125;,e.exports=t[<span class="string">"default"</span>]&#125;]);</span><br><span class="line">      flex(<span class="number">100</span>, <span class="number">1</span>);&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>然后在/config/webpack.config.dev.js 增加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pxtorem = <span class="built_in">require</span>(<span class="string">'postcss-pxtorem'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">                oneOf: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(svg)$/i</span>,</span><br><span class="line">                        loader: <span class="string">'svg-sprite-loader'</span>,</span><br><span class="line">                        include: [</span><br><span class="line">                        <span class="built_in">require</span>.resolve(<span class="string">'antd-mobile'</span>).replace(<span class="regexp">/warn\.js$/</span>, <span class="string">''</span>), <span class="comment">// 1. svg files of antd-mobile</span></span><br><span class="line">                        path.resolve(__dirname, <span class="string">'../src/icons'</span>), <span class="comment">// folder of svg files in your project</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                        use: [</span><br><span class="line">                        <span class="built_in">require</span>.resolve(<span class="string">'style-loader'</span>),</span><br><span class="line">                        <span class="built_in">require</span>.resolve(<span class="string">'css-loader'</span>),</span><br><span class="line">                        &#123;</span><br><span class="line">                            loader: <span class="built_in">require</span>.resolve(<span class="string">'postcss-loader'</span>),</span><br><span class="line">                            options: &#123;</span><br><span class="line">                            ident: <span class="string">'postcss'</span>, <span class="comment">// https://webpack.js.org/guides/migrating/#complex-options</span></span><br><span class="line">                            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">                                autoprefixer(&#123;</span><br><span class="line">                                browsers: [<span class="string">'last 2 versions'</span>, <span class="string">'Firefox ESR'</span>, <span class="string">'&gt; 1%'</span>, <span class="string">'ie &gt;= 8'</span>, <span class="string">'iOS &gt;= 8'</span>, <span class="string">'Android &gt;= 4'</span>],</span><br><span class="line">                                &#125;),</span><br><span class="line">                                pxtorem(&#123; <span class="attr">rootValue</span>: <span class="number">100</span>, <span class="attr">propWhiteList</span>: [] &#125;)</span><br><span class="line">                            ],</span><br><span class="line">                            &#125;,</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &#123;</span><br><span class="line">                            loader: <span class="built_in">require</span>.resolve(<span class="string">'less-loader'</span>),</span><br><span class="line">                            options: &#123;</span><br><span class="line">                            modifyVars: &#123; <span class="string">"@primary-color"</span>: <span class="string">"#1DA57A"</span> &#125;,</span><br><span class="line">                            &#125;,</span><br><span class="line">                        &#125;],</span><br><span class="line">                    &#125;]</span><br><span class="line">            &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="yarn-run-eject-和-antd加入"><a href="#yarn-run-eject-和-antd加入" class="headerlink" title="yarn run eject 和 antd加入"></a>yarn run eject 和 antd加入</h2><p>由于需要使用mobx 的”@” decorator 功能。yarn run eject 解开webpack 之后<br><code>yarn add babel-plugin-transform-decorators-legacy --dev</code>,<br>同时/package.json 加上</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">"babel": &#123;</span><br><span class="line">    "plugins": [</span><br><span class="line">        "transform-decorators-legacy",</span><br><span class="line">        [</span><br><span class="line">            <span class="string">"import"</span>, &#123; <span class="attr">"libraryName"</span>: <span class="string">"antd-mobile"</span>, <span class="attr">"style"</span>: <span class="string">"css"</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时为了打包yarn build 项目路由能找到静态文件,在/package.json <code>&quot;homepage&quot;: &quot;.&quot;</code>. <strong>重要</strong></p>
<h2 id="项目目录"><a href="#项目目录" class="headerlink" title="项目目录"></a>项目目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/src</span><br><span class="line">    /axios</span><br><span class="line">    /components</span><br><span class="line">    /constants</span><br><span class="line">    /icons</span><br><span class="line">    /pages//各个页面的page</span><br><span class="line">    /router/index//路由中心</span><br><span class="line">    /routes//各级路由和总根路由</span><br><span class="line">    /store//各个store和index store</span><br><span class="line">    /utils</span><br><span class="line">    index.js</span><br><span class="line">    index.css</span><br><span class="line">package.json</span><br></pre></td></tr></table></figure>
<h2 id="解决编译后某个bug"><a href="#解决编译后某个bug" class="headerlink" title="解决编译后某个bug"></a>解决编译后某个bug</h2><p>/public/index.html <head><meta name="generator" content="Hexo 3.8.0"></head> 中间加上:<br><code>&lt;script type=&quot;text/babel&quot; src=&quot;./lander.js&quot;&gt;&lt;/script&gt;</code></p>
<h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><p>build 的语法同样很重要，否则出现Nginx 配置路由，启动build 后的项目变成阅览文件目录:<br><code>$ PUBLIC_URL=http://lsgood.top yarn build</code></p>
<p>原由是/public/index.html 的link 写到：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"manifest"</span> <span class="attr">href</span>=<span class="string">"%PUBLIC_URL%/manifest.json"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">href</span>=<span class="string">"%PUBLIC_URL%/favicon.ico"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意PUBLIC_URL(当时不知道解决方案，花了三天，愁的都长痘痘了).</p>
<h2 id="Nginx-配置"><a href="#Nginx-配置" class="headerlink" title="Nginx 配置"></a>Nginx 配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80 default_server;</span><br><span class="line">        server_name www.lsgood.top lsgood.top;</span><br><span class="line"></span><br><span class="line">        root /var/www;</span><br><span class="line">        index index.html index.htm;      </span><br><span class="line">        # Any route that doesn&apos;t have a file extension (e.g. /devices)</span><br><span class="line">        location ~ ^/favicon\.ico$ &#123;</span><br><span class="line">            root /var/www;</span><br><span class="line">        &#125;</span><br><span class="line">        location / &#123;</span><br><span class="line">            try_files $uri $uri/ /index.html;</span><br><span class="line">            index index.html;</span><br><span class="line">            proxy_set_header   Host             $host;</span><br><span class="line">            proxy_set_header   X-Real-IP        $remote_addr;</span><br><span class="line">            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_set_header   X-Forwarded-Proto  $scheme;</span><br><span class="line">        &#125;</span><br><span class="line">        location @fallback &#123;</span><br><span class="line">            rewrite ^.*$ /index.html break;</span><br><span class="line">        &#125;</span><br><span class="line">        location /girlS/ &#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:8000/girl.v1/;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /popcircle/ &#123;</span><br><span class="line">            root /root/Work/game/;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这样多个路由就能看到不同点了</p>
<h2 id="Mobx-在上面的使用"><a href="#Mobx-在上面的使用" class="headerlink" title="Mobx 在上面的使用"></a>Mobx 在上面的使用</h2><p>/src/store/下存储着各个store 具体事务，index 是其中的集合体。</p>
<p>/src/index.js 下导入“mobx-react” 的Provider，引入了所有的store。</p>
<p>这样在使用时，如/store:topics.js, /pages:Default.js inject关联store:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@inject(<span class="function">(<span class="params">&#123;topics, status&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    data: topics.data</span><br><span class="line">&#125;))</span><br><span class="line">@observer <span class="class"><span class="keyword">class</span> <span class="title">DefaultClass</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    ...this.props.data<span class="comment">//就拿出来了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>store.js 里面一般会有4个方法:{ observable, action, useStrict }<br>action 的作用是，强制用户在该方法下更改被observable 的属性, 用法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@observable data;</span><br><span class="line">@action.bound updateData(val) &#123;</span><br><span class="line">    <span class="keyword">this</span>.data = val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时,action.bound 可以正确获得this 指针.</p>
<p>最后export 这个单例对象:<code>export default new Store();</code>，放到/src/store/index.js 的<code>export default {store}</code>下,完成合并store，以便所有节点都可以inject.<br>···</p>

  </article>
  <footer class="f-cf">
    
      <a href="/2018/12/01/2018-12-1lesson/" class="link f-fl">⟵2018-12-1lesson</a>
    
    
      <a href="/2018/11/10/2018-11-10lesson/" class="link f-fr">2018-11-10lesson⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  d.guangying@foxmail.com
  
    
      
        · <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">Dribbble</a>
      
    
      
        · <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">Behance</a>
      
    
      
        · <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn">Lofter</a>
      
    
      
        · <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn">Instagram</a>
      
    
      
        · <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>